<main class="main-content">
    <h1 class="page-title">
        <i class="fas fa-user-circle"></i>
        Thông tin cá nhân
    </h1>
    
    <div class="profile-container">
        <div class="profile-header">
            <div class="profile-avatar">
                <!-- Hiển thị avatar tạm thời hoặc avatar hiện tại -->
                <img 
                    [src]="tempAvatarImage || getFullImageUrl(profile.avatarImage)" 
                    alt="Avatar" 
                    class="avatar-image">
                <div class="avatar-upload" (click)="triggerAvatarUpload()">
                    <i class="fas fa-camera"></i>
                </div>
                
                <!-- Nút lưu/hủy khi có avatar tạm thời -->
                <div *ngIf="tempAvatarImage" class="avatar-actions">
                    <button class="btn btn-sm btn-success" (click)="saveAvatar()" [disabled]="isUploadingAvatar">
                        <i class="fas fa-check"></i> 
                        {{ isUploadingAvatar ? 'Đang lưu...' : 'Lưu' }}
                    </button>
                    <button class="btn btn-sm btn-secondary" (click)="cancelAvatarChange()">
                        <i class="fas fa-times"></i> Hủy
                    </button>
                </div>
            </div>
            <div class="user-name">{{ profile.fullName }}</div>
            <div class="user-role">{{ getUserRole() }} - {{ getUserDepartment() }}</div>
        </div>
        
        <div class="profile-body">
            <div class="profile-tabs">
                <div 
                    class="profile-tab" 
                    [class.active]="activeTab === 'info'"
                    (click)="switchTab('info')">
                    Thông tin cá nhân
                </div>
                <div 
                    class="profile-tab" 
                    [class.active]="activeTab === 'signature'"
                    (click)="switchTab('signature')">
                    Chữ ký
                </div>
                <div 
                    class="profile-tab" 
                    [class.active]="activeTab === 'activity'"
                    (click)="switchTab('activity')">
                    Hoạt động
                </div>
            </div>
            
            <!-- Tab Thông tin cá nhân -->
            <div class="tab-content" [class.active]="activeTab === 'info'">
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-user"></i>
                        Thông tin cơ bản
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Họ và tên</label>
                            <input 
                                type="text" 
                                class="form-control" 
                                [(ngModel)]="formData.fullName">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input 
                                type="email" 
                                class="form-control" 
                                [(ngModel)]="formData.email">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Số điện thoại</label>
                            <input 
                                type="tel" 
                                class="form-control" 
                                [(ngModel)]="formData.phone">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Chức vụ</label>
                            <input 
                                type="text" 
                                class="form-control" 
                                [(ngModel)]="formData.position">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Phòng ban</label>
                            <select class="form-select" [(ngModel)]="formData.department">
                                <option>Phòng Kinh doanh</option>
                                <option>Phòng Nhân sự</option>
                                <option>Phòng Kế toán</option>
                                <option>Phòng Kỹ thuật</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ngày vào công ty</label>
                            <input 
                                type="date" 
                                class="form-control" 
                                [(ngModel)]="formData.joinDate">
                        </div>
                    </div>
                </div>
                
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-lock"></i>
                        Đổi mật khẩu
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Mật khẩu hiện tại</label>
                            <input 
                                type="password" 
                                class="form-control" 
                                placeholder="Nhập mật khẩu hiện tại"
                                [(ngModel)]="formData.currentPassword">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Mật khẩu mới</label>
                            <input 
                                type="password" 
                                class="form-control" 
                                placeholder="Nhập mật khẩu mới"
                                [(ngModel)]="formData.newPassword">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Xác nhận mật khẩu mới</label>
                        <input 
                            type="password" 
                            class="form-control" 
                            placeholder="Xác nhận mật khẩu mới"
                            [(ngModel)]="formData.confirmPassword">
                    </div>
                </div>
            </div>
            
            <!-- Tab Chữ ký -->
            <div class="tab-content" [class.active]="activeTab === 'signature'">
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-signature"></i>
                        Quản lý chữ ký
                    </div>
                    
                    <div class="signature-section">
                        <div class="signature-preview">
                            <h4>Chữ ký hiện tại</h4>
                            <!-- Hiển thị chữ ký tạm thời hoặc chữ ký hiện tại -->
                            <img 
                                [src]="tempSignatureImage || getFullImageUrl(profile.signatureImage)" 
                                alt="Chữ ký" 
                                class="signature-image">
                            <div class="signature-actions">
                                <button class="btn btn-primary" (click)="downloadSignature()">
                                    <i class="fas fa-download"></i> Tải xuống
                                </button>
                            </div>
                        </div>
                        
                        <div class="signature-methods">
                            <div 
                                class="signature-method" 
                                (click)="selectSignatureMethod('upload')"
                                [class.active]="selectedSignatureMethod === 'upload'">
                                <div class="method-icon">
                                    <i class="fas fa-upload"></i>
                                </div>
                                <div class="method-title">Tải lên ảnh</div>
                                <div class="method-description">Tải lên ảnh chữ ký có sẵn</div>
                            </div>
                            
                            <div 
                                class="signature-method" 
                                (click)="selectSignatureMethod('draw')"
                                [class.active]="selectedSignatureMethod === 'draw'">
                                <div class="method-icon">
                                    <i class="fas fa-pen"></i>
                                </div>
                                <div class="method-title">Vẽ chữ ký</div>
                                <div class="method-description">Vẽ chữ ký trực tiếp</div>
                            </div>
                        </div>
                        
                        <!-- Form upload ảnh chữ ký -->
                        <div 
                            class="signature-canvas-container" 
                            *ngIf="selectedSignatureMethod === 'upload'">
                            <div class="upload-section">
                                <div class="upload-area" (click)="triggerSignatureUpload()">
                                    <i class="fas fa-cloud-upload-alt upload-icon"></i>
                                    <div>Click để tải lên ảnh chữ ký</div>
                                    <div style="color: #7f8c8d; font-size: 14px; margin-top: 5px;">
                                        (Hỗ trợ: JPG, PNG, GIF, tối đa 5MB)
                                    </div>
                                </div>

                                <!-- Preview và nút lưu/hủy cho chữ ký upload -->
                                <div *ngIf="tempSignatureImage" class="upload-preview">
                                    <h6>Preview chữ ký:</h6>
                                    <img [src]="tempSignatureImage" alt="Preview chữ ký" class="preview-image">
                                    <div class="preview-actions">
                                        <button class="btn btn-secondary" (click)="cancelSignatureUpload()">
                                            <i class="fas fa-times"></i> Hủy
                                        </button>
                                        <button class="btn btn-primary" (click)="saveUploadedSignature()" [disabled]="isUploadingSignature">
                                            <i class="fas fa-save"></i> 
                                            {{ isUploadingSignature ? 'Đang lưu...' : 'Lưu chữ ký' }}
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Form vẽ chữ ký -->
                        <div 
                            class="signature-canvas-container" 
                            *ngIf="selectedSignatureMethod === 'draw'">
                            <div class="drawing-section">
                                <p class="drawing-instruction">Vẽ chữ ký của bạn vào khung bên dưới:</p>
                                <canvas #signatureCanvas class="signature-canvas"></canvas>
                                <div class="canvas-actions">
                                    <button class="btn btn-secondary" (click)="clearCanvas()">
                                        <i class="fas fa-eraser"></i> Xóa
                                    </button>
                                    <button class="btn btn-primary" (click)="saveSignature()">
                                        <i class="fas fa-save"></i> Lưu chữ ký
                                    </button>
                                    <button class="btn btn-outline" (click)="cancelSignatureUpload()">
                                        <i class="fas fa-times"></i> Hủy
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Tab Hoạt động -->
            <div class="tab-content" [class.active]="activeTab === 'activity'">
                <!-- ... existing activity content ... -->
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-secondary" (click)="cancelChanges()">
                    <i class="fas fa-times"></i> Hủy
                </button>
                <button class="btn btn-primary" (click)="saveChanges()" [disabled]="isSavingProfile">
                    <i class="fas fa-save"></i> 
                    {{ isSavingProfile ? 'Đang lưu...' : 'Lưu thay đổi' }}
                </button>
            </div>
        </div>
    </div>
</main>